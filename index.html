<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fragment Launcher</title>
<link rel="manifest" href="manifest.json">
<link rel="icon" href="https://i-mg24.ru/images/122625155338-t2mic.png" type="image/png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* Core & Reset */
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg-primary:#0a0a0a;--bg-secondary:#1a1a1a;--glass-bg:rgba(30,30,35,.65);--glass-border:rgba(255,255,255,.12);--text-primary:#e0e0e0;--text-secondary:#b0b0b0;--accent:#6c63ff;--card-padding:20px;--font-size-base:15px;--card-size:280px}
body.light-theme{--bg-primary:#f5f5f5;--bg-secondary:#fff;--glass-bg:rgba(255,255,255,.65);--glass-border:rgba(0,0,0,.12);--text-primary:#1a1a1a;--text-secondary:#666}
body.neon-theme{--bg-primary:#0a0014;--glass-bg:rgba(138,43,226,.15);--glass-border:rgba(255,0,255,.4);--text-primary:#fff;--text-secondary:#d0b3ff;--accent:#f0f;background:radial-gradient(circle at 20% 50%,rgba(138,43,226,.2) 0,transparent 50%),radial-gradient(circle at 80% 50%,rgba(255,0,255,.2) 0,transparent 50%),linear-gradient(135deg,#0a0014 0,#0f001f 50%,#14002b 100%)}
body.neon-theme .logo{background:linear-gradient(135deg,#f0f 0,#0ff 50%,#f0f 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:drop-shadow(0 0 15px rgba(255,0,255,.8))}
body.neon-theme .glass{background:rgba(138,43,226,.15);border:2px solid rgba(255,0,255,.4);box-shadow:0 0 30px rgba(255,0,255,.3)}
body.cosmic-theme{--bg-primary:#0a0a1e;--glass-bg:rgba(20,20,50,.7);--glass-border:rgba(100,149,237,.4);--text-primary:#fff;--text-secondary:#b0c4de;--accent:#6495ed;background:radial-gradient(circle at 10% 20%,rgba(100,149,237,.15) 0,transparent 30%),radial-gradient(circle at 90% 80%,rgba(138,43,226,.15) 0,transparent 30%),linear-gradient(135deg,#0a0a1e 0,#1a1a3e 50%,#2a2a5e 100%);position:relative}
body.cosmic-theme::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:radial-gradient(2px 2px at 20% 30%,#fff,transparent),radial-gradient(2px 2px at 60% 70%,#fff,transparent),radial-gradient(1px 1px at 50% 50%,#fff,transparent);background-size:200% 200%,150% 150%,250% 250%;animation:stars 200s linear infinite;z-index:1;pointer-events:none}
@keyframes stars{to{transform:translateY(-100px)}}
body.cosmic-theme .glass{background:rgba(20,20,50,.75);border:1px solid rgba(100,149,237,.4);position:relative;z-index:10}
body.font-default{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
body.font-monospace{font-family:'Courier New',Courier,monospace}
body.font-rounded{font-family:'Arial Rounded MT Bold','Helvetica Rounded',Arial,sans-serif}
body.size-compact{--card-padding:15px;--font-size-base:13px;--card-size:220px}
body.size-large{--card-padding:25px;--font-size-base:17px;--card-size:320px}

/* Global Select Protection */
body {
    font-size:var(--font-size-base);
    background:linear-gradient(135deg,var(--bg-primary) 0,var(--bg-secondary) 100%);
    color:var(--text-primary);
    min-height:100vh;
    transition:all .4s ease;
    user-select: none; /* Prevent selection by default */
}
/* Allow selection in specific areas */
.selectable, .game-title, .game-info, .section p, .review-text, .requirements, input, textarea, .faq-answer {
    user-select: text;
}

.glass{background:var(--glass-bg);backdrop-filter:blur(25px) saturate(200%);border:1px solid var(--glass-border);box-shadow:0 8px 32px rgba(0,0,0,.4)}
@keyframes slideIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}
@keyframes gradientFlow{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
@keyframes primeShine {0%{background-position: 0% 50%} 50%{background-position: 100% 50%} 100%{background-position: 0% 50%}}

.snowflake{position:fixed;top:-10px;z-index:5;color:rgba(255,255,255,.8);font-size:1em;animation:fall linear infinite;pointer-events:none}
@keyframes fall{to{transform:translateY(100vh) rotate(360deg)}}
.mobile-warning{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:var(--bg-primary);z-index:10000;justify-content:center;align-items:center;text-align:center;padding:20px}
.mobile-warning h1{color:#f44;margin-bottom:20px}

/* Header & Sidebar */
.header{background:rgba(28,28,32,.75);backdrop-filter:blur(25px);padding:15px 30px;display:flex;align-items:center;gap:20px;box-shadow:0 4px 20px rgba(0,0,0,.5);position:sticky;top:0;z-index:100}
.menu-btn{background:linear-gradient(135deg,var(--accent) 0,#5a52d5 100%);border:none;color:#fff;padding:12px 18px;cursor:pointer;border-radius:14px;font-size:18px;transition:all .4s ease}
.menu-btn:hover{transform:translateY(-3px)}
.logo{font-size:28px;font-weight:700;background:linear-gradient(135deg,var(--accent) 0,#a855f7 50%,#ec4899 100%);background-size:200% 200%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;cursor:pointer;animation:gradientFlow 3s ease infinite}
.search-container{margin-left:auto;position:relative}
.search-input{background:rgba(45,45,50,.6);border:1px solid var(--glass-border);padding:12px 20px;border-radius:25px;color:var(--text-primary);width:350px;transition:all .4s ease}
.search-input:focus{outline:0;border-color:var(--accent);width:400px}
.account-btn{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,var(--accent) 0,#5a52d5 100%);border:none;color:#fff;font-size:24px;cursor:pointer;transition:all .4s ease;display:flex;align-items:center;justify-content:center}
.account-btn:hover{transform:translateY(-3px)}
.account-btn.logged-in{background:0 0;padding:0;overflow:hidden}
.account-btn.logged-in img{width:100%;height:100%;object-fit:cover}
.search-results{position:absolute;top:110%;left:0;right:0;background:rgba(35,35,40,.95);backdrop-filter:blur(25px);border-radius:18px;max-height:400px;overflow-y:auto;display:none;box-shadow:0 8px 32px rgba(0,0,0,.5)}
.search-result-item{padding:15px;cursor:pointer;display:flex;gap:15px;align-items:center;transition:all .3s ease}
.search-result-item:hover{background:rgba(108,99,255,.15)}
.search-result-item img{width:60px;height:60px;object-fit:cover;border-radius:12px}
.search-result-type{margin-left:auto;padding:4px 12px;border-radius:12px;font-size:11px;font-weight:700}
.search-result-type.game{background:rgba(76,175,80,.2);color:#4caf50}
.search-result-type.account{background:rgba(33,150,243,.2);color:#2196f3}
.sidebar{position:fixed;left:-320px;top:0;width:320px;height:100%;background:rgba(28,28,32,.95);backdrop-filter:blur(30px);transition:left .4s ease;z-index:1000;padding:90px 25px 25px; display: flex; flex-direction: column;}
.sidebar.open{left:0}
.sidebar-item{padding:18px 25px;margin-bottom:12px;cursor:pointer;border-radius:16px;background:rgba(45,45,50,.5);transition:all .4s ease}
.sidebar-item:hover{background:rgba(108,99,255,.25);transform:translateX(12px)}
.sidebar-footer { margin-top: auto; padding-top: 20px; border-top: 1px solid var(--glass-border); text-align: center; }
.support-link { color: var(--accent); text-decoration: none; font-weight: bold; font-size: 14px; display: block; margin-bottom: 5px; cursor: pointer;}
.copyright { color: var(--text-secondary); font-size: 12px; }

/* Prime Status */
.prime-user {
    background: linear-gradient(135deg, #ffd700 0%, #fdb931 25%, #fff 50%, #fdb931 75%, #ffd700 100%);
    background-size: 200% auto;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: primeShine 3s linear infinite;
    font-weight: bold;
}

/* Featured & Grid */
.featured-game{width:100%;height:500px;position:relative;overflow:hidden;margin-bottom:50px}
.featured-game img{width:100%;height:100%;object-fit:cover;transition:transform .6s ease}
.featured-game:hover img{transform:scale(1.05)}
.featured-overlay{position:absolute;bottom:0;left:0;right:0;background:linear-gradient(transparent,rgba(0,0,0,.95));padding:50px}
.featured-title{font-size:48px;font-weight:700;margin-bottom:15px;color:#fff}
.games-section{padding:0 40px 40px}
.games-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}
.random-game-btn{background:linear-gradient(135deg,#ff6b6b 0,#ee5a6f 100%);border:none;color:#fff;padding:12px 25px;border-radius:14px;cursor:pointer;font-weight:700;transition:all .3s ease;font-size:16px}
.random-game-btn:hover{transform:translateY(-3px)}
.games-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(var(--card-size),1fr));gap:30px}
.game-card{background:var(--glass-bg);backdrop-filter:blur(20px);border-radius:20px;overflow:visible;cursor:pointer;transition:all .5s ease;border:1px solid var(--glass-border);animation:slideIn .6s ease both;position:relative}
.game-card:hover{transform:translateY(-12px);box-shadow:0 20px 50px rgba(108,99,255,.4)}
.new-badge{position:absolute;top:15px;right:15px;background:linear-gradient(135deg,#ff6b6b 0,#ee5a6f 100%);color:#fff;padding:6px 14px;border-radius:20px;font-size:12px;font-weight:700;z-index:10;animation:pulse 2s ease-in-out infinite;cursor:help;white-space:nowrap}
.new-badge .tooltip{visibility:hidden;opacity:0;position:absolute;bottom:-60px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.95);color:#fff;padding:10px 15px;border-radius:10px;font-size:12px;white-space:nowrap;transition:all .3s ease}
.new-badge:hover .tooltip{visibility:visible;opacity:1;bottom:-70px}
.game-card img{width:100%;height:180px;object-fit:cover;transition:transform .5s ease;border-radius:20px 20px 0 0}
.game-card:hover img{transform:scale(1.1)}
.game-card-content{padding:var(--card-padding)}
.game-card-title{font-size:calc(var(--font-size-base) + 5px);font-weight:700;margin-bottom:10px}
.game-card-title.gradient{background:linear-gradient(135deg,var(--accent) 0,#a855f7 50%,#ec4899 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.game-card-title.outlined{color:#fff;text-shadow:-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000}

/* Game Page */
.game-page{display:none;animation:slideIn .6s ease;padding:40px}
.game-banner{width:100%;height:450px;object-fit:cover;border-radius:24px;margin-bottom:-100px}
.game-header{display:flex;gap:25px;margin-bottom:40px;position:relative;z-index:1}
.game-avatar-container{position:relative}
.game-avatar{width:180px;height:180px;border-radius:24px;border:4px solid var(--bg-secondary);object-fit:cover}
.game-id-display{margin-top:10px;font-size:12px;color:var(--text-secondary);text-align:center;font-family:monospace;display:none}
.game-info{flex:1;display:flex;flex-direction:column;justify-content:flex-end}
.game-title-wrapper{display:flex;align-items:center;gap:15px;margin-bottom:10px}
.game-title-wrapper .new-badge{position:relative;animation:pulse 2s ease-in-out infinite}
.game-title-wrapper .new-badge .tooltip{bottom:auto;top:-60px;left:50%;transform:translateX(-50%)}.game-title-wrapper .new-badge:hover .tooltip{bottom:auto;top:-70px}
.game-title{font-size:48px;font-weight:700}
.game-title.gradient{background:linear-gradient(135deg,var(--accent) 0,#a855f7 50%,#ec4899 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.game-title.outlined{color:#fff;text-shadow:-2px -2px 0 #000,2px -2px 0 #000,-2px 2px 0 #000,2px 2px 0 #000}
.playtime-container{margin-top:15px;margin-bottom:20px;display:flex;align-items:center;gap:10px}
.playtime-display{background:rgba(76,175,80,.2);border:1px solid rgba(76,175,80,.4);padding:10px 20px;border-radius:12px;color:#4caf50;font-weight:700;display:flex;align-items:center;gap:10px}
.last-played{font-size:12px;color:var(--text-secondary);margin-left:15px;font-style:italic}
.playtime-btn,.playtime-remove-btn{border:none;color:#fff;padding:8px 12px;border-radius:50%;cursor:pointer;font-weight:700;transition:all .3s ease;font-size:18px;display:flex;align-items:center;justify-content:center;width:36px;height:36px}
.playtime-btn{background:linear-gradient(135deg,#4caf50 0,#45a049 100%)}
.playtime-remove-btn{background:linear-gradient(135deg,#f44336 0,#d32f2f 100%)}
.playtime-btn:hover,.playtime-remove-btn:hover{transform:translateY(-2px) scale(1.1)}
.game-actions{display:flex;gap:15px;flex-wrap:wrap}
.btn{background:linear-gradient(135deg,var(--accent) 0,#5a52d5 100%);border:none;color:#fff;padding:15px 35px;border-radius:16px;cursor:pointer;font-size:16px;font-weight:700;transition:all .4s ease}
.btn:hover{transform:translateY(-3px)}
.btn-secondary{background:linear-gradient(135deg,#444 0,#555 100%)}
.settings-btn, .notes-btn{background:linear-gradient(135deg,#444 0,#555 100%);border:none;color:#fff;padding:15px 18px;border-radius:16px;cursor:pointer;font-size:20px;transition:all .4s ease}
.settings-btn:hover{transform:translateY(-3px) rotate(90deg)}
.notes-btn:hover{transform:translateY(-3px)}
.section{background:var(--glass-bg);backdrop-filter:blur(25px);padding:30px;border-radius:24px;margin-bottom:30px;border:1px solid var(--glass-border)}
.section-title{font-size:28px;margin-bottom:20px;border-bottom:2px solid var(--accent);padding-bottom:12px}
.launch-methods{display:grid;grid-template-columns:1fr 1fr;gap:25px;margin-top:20px}
.launch-method{background:rgba(45,45,50,.4);padding:25px;border-radius:18px}
.method-title{font-size:20px;font-weight:700;color:var(--accent);margin-bottom:15px}
.gallery{display:flex;gap:20px;overflow-x:auto}
.gallery img{height:220px;border-radius:16px;cursor:pointer;transition:all .4s ease}
.gallery img:hover{transform:scale(1.08)}
.requirements-toggle{display:flex;gap:15px;margin-bottom:20px}
.req-btn{background:rgba(45,45,50,.6);border:1px solid var(--glass-border);color:var(--text-primary);padding:12px 25px;cursor:pointer;border-radius:14px;transition:all .4s ease}
.req-btn.active{background:linear-gradient(135deg,var(--accent) 0,#5a52d5 100%);color:#fff}
.requirements{display:none;line-height:1.8}.requirements.active{display:block}
.reviews-section{margin-top:20px}
.review-card{background:rgba(45,45,50,.4);padding:20px;border-radius:16px;margin-bottom:15px;border:1px solid var(--glass-border)}
.review-header{display:flex;align-items:center;gap:15px;margin-bottom:12px}
.review-avatar{width:45px;height:45px;border-radius:12px;object-fit:cover;cursor:pointer}
.review-author{font-weight:700;font-size:16px}.review-date{font-size:13px;color:var(--text-secondary)}.review-rating{margin-left:auto;color:#ffd700;font-size:18px}
.review-text{line-height:1.6;color:var(--text-secondary)}

/* FAQ Styles */
.faq-container{display:flex;flex-direction:column;gap:15px}
.faq-item{background:rgba(45,45,50,.4);border-radius:16px;border:1px solid var(--glass-border);overflow:hidden;transition:all .3s ease}
.faq-question{padding:20px;cursor:pointer;font-weight:700;display:flex;justify-content:space-between;align-items:center}
.faq-question:hover{background:rgba(108,99,255,.1)}
.faq-answer{padding:0 20px;max-height:0;overflow:hidden;transition:all .4s ease;color:var(--text-secondary);line-height:1.6}
.faq-item.active .faq-answer{padding:20px;max-height:500px;border-top:1px solid var(--glass-border)}
.faq-icon{transition:transform .4s ease}
.faq-item.active .faq-icon{transform:rotate(180deg)}

/* Modals */
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);backdrop-filter:blur(10px);z-index:2000;justify-content:center;align-items:center}
#badgeModal{z-index:2100}
.modal-content{background:var(--glass-bg);backdrop-filter:blur(35px);padding:40px;border-radius:28px;max-width:800px;width:90%;border:1px solid var(--glass-border);position:relative;max-height:90vh;overflow-y:auto}
.modal-close{position:absolute;top:20px;right:20px;background:rgba(255,255,255,.1);border:none;color:#fff;width:35px;height:35px;border-radius:50%;cursor:pointer;font-size:20px;display:flex;align-items:center;justify-content:center;transition:all .3s ease}
.modal-close:hover{transform:rotate(90deg)}
.modal-title{font-size:28px;margin-bottom:25px;background:linear-gradient(135deg,var(--accent) 0,#a855f7 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.form-group{margin-bottom:20px}
.form-group label{display:block;margin-bottom:8px;font-weight:500}
.form-group input,.form-group select,.form-group textarea{width:100%;background:rgba(45,45,50,.7);border:1px solid var(--glass-border);padding:12px 15px;border-radius:14px;color:var(--text-primary);transition:all .4s ease}
.form-group input:focus,.form-group select:focus,.form-group textarea:focus{outline:0;border-color:var(--accent)}
.settings-group{margin-bottom:30px}
.settings-group label{display:block;margin-bottom:12px;font-size:19px;font-weight:500}
.range-slider{width:100%;height:10px;border-radius:5px;background:rgba(255,255,255,0.1);outline:none;appearance:none;}
.range-slider::-webkit-slider-thumb{appearance:none;width:20px;height:20px;border-radius:50%;background:var(--accent);cursor:pointer;}

/* Profile & Levels */
.account-profile{background:var(--glass-bg);backdrop-filter:blur(25px);padding:30px;border-radius:24px;display:flex;align-items:center;gap:25px;margin-bottom:30px;border:1px solid var(--glass-border)}
.profile-avatar-wrapper{position:relative}
.profile-avatar{width:100px;height:100px;border-radius:20px;object-fit:cover;border:3px solid var(--accent);cursor:pointer}
.avatar-edit-icon{position:absolute;bottom:0;right:0;background:var(--accent);color:#fff;width:30px;height:30px;border-radius:50%;display:none;align-items:center;justify-content:center;cursor:pointer;font-size:16px;border:2px solid var(--bg-secondary)}
.profile-name{font-size:28px;font-weight:700;display:flex;align-items:center;gap:12px}
.profile-badge{width:24px;height:24px;cursor:pointer}
.profile-created{font-size:14px;color:var(--text-secondary);margin-top:5px}
.profile-stats{font-size:16px;color:var(--accent);margin-top:10px;font-weight:700}
.profile-telegram{background:linear-gradient(135deg,#2aabee 0,#229ed9 100%);border:none;color:#fff;padding:10px 20px;border-radius:12px;cursor:pointer;display:inline-flex;align-items:center;gap:8px;margin-top:10px;transition:all .4s ease}
.profile-uid { font-size: 10px; color: var(--text-secondary); text-align: center; margin-top: 5px; opacity: 0.5; }

/* Level Badges */
.level-container {display: flex; align-items: center; gap: 15px; margin-top: 15px;}
.level-shape {width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; position: relative; transition: all 0.3s ease; border: 2px solid transparent; background: transparent;}

/* Basic Levels */
.lvl-white {border-color: #e0e0e0; color: #e0e0e0; box-shadow: 0 0 10px rgba(255,255,255,0.2);}
.lvl-yellow {border-color: #ffd700; color: #ffd700; box-shadow: 0 0 10px rgba(255,215,0,0.2);}
.lvl-orange {border-color: #ff9800; color: #ff9800; box-shadow: 0 0 10px rgba(255,152,0,0.2);}
.lvl-red {border-color: #f44336; color: #f44336; box-shadow: 0 0 10px rgba(244,67,54,0.2);}
.lvl-blue {border-color: #2196f3; color: #2196f3; box-shadow: 0 0 10px rgba(33,150,243,0.2);}
.lvl-purple {border-color: #9c27b0; color: #9c27b0; box-shadow: 0 0 10px rgba(156,39,176,0.2);}

/* Special Levels (25-49) - Unique Designs */
.lvl-25 { background: #000; border-color: #00ffff; color: #00ffff; box-shadow: 0 0 15px rgba(0,255,255,0.6); }
.lvl-30 { background: #000; border-color: #32cd32; color: #32cd32; box-shadow: 0 0 15px rgba(50,205,50,0.6); }
.lvl-35 { background: #000; border-color: #ff1493; color: #ff1493; box-shadow: 0 0 15px rgba(255,20,147,0.6); }
.lvl-40 { background: #000; border-color: #ff4500; color: #ff4500; box-shadow: 0 0 15px rgba(255,69,0,0.6); }
.lvl-45 { background: #000; border-color: #e0e0e0; color: #e0e0e0; box-shadow: 0 0 15px rgba(255,255,255,0.8); text-shadow: 0 0 5px white; }

/* 50+: Black Special */
.lvl-50 {
    background: #050505;
    border-color: #333;
    color: #fff;
    box-shadow: 0 0 15px rgba(0,0,0,0.9);
}
.lvl-text-gradient {
    background: linear-gradient(135deg, #fff 0%, #888 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    font-weight: 900;
}

.level-info {display: flex; flex-direction: column; font-size: 12px; color: var(--text-secondary);}

/* Chart & Recent Activity */
.chart-wrapper { display: flex; height: 250px; margin-top: 30px; gap: 10px; padding-bottom: 20px; border-bottom: 1px solid var(--glass-border); }
.chart-y-axis { display: flex; flex-direction: column; justify-content: space-between; font-size: 10px; color: var(--text-secondary); text-align: right; padding-right: 10px; height: 100%; width: 40px; }
.chart-container { flex: 1; display: flex; align-items: flex-end; justify-content: space-between; gap: 5px; height: 100%; }
.chart-bar-wrapper {display: flex; flex-direction: column; align-items: center; width: 100%; height: 100%; justify-content: flex-end;}
.chart-bar {width: 20px; background: #9c27b0; border-radius: 4px 4px 0 0; transition: height 0.5s ease; min-height: 2px;}
.chart-bar:hover::after { content: attr(title); position: absolute; background: rgba(0,0,0,0.9); color: #fff; padding: 5px 10px; border-radius: 5px; font-size: 12px; bottom: 100%; white-space: nowrap; pointer-events: none; }
.chart-bar-wrapper:hover .chart-bar { filter: brightness(1.2); }
.chart-date {font-size: 10px; color: var(--text-secondary); margin-top: 5px; transform: rotate(-45deg); height: 15px;}
.recent-activity {margin-top: 30px;}
.recent-list {display: flex; flex-direction: column; gap: 10px;}
.recent-item {display: flex; align-items: center; gap: 15px; background: rgba(45,45,50,0.3); padding: 10px; border-radius: 12px;}
.recent-item img {width: 40px; height: 40px; border-radius: 8px; object-fit: cover;}

/* Extras */
.backup-section{margin-top:40px;padding:25px;background:rgba(76,175,80,.1);border-radius:18px;border:1px solid rgba(76,175,80,.3)}
.backup-title{font-size:22px;font-weight:700;color:#4caf50;margin-bottom:15px;cursor:pointer;user-select:none}
.backup-buttons{display:flex;gap:15px;margin-top:20px}
.backup-btn{background:linear-gradient(135deg,#4caf50 0,#45a049 100%);border:none;color:#fff;padding:12px 25px;border-radius:14px;cursor:pointer;font-weight:700;transition:all .3s ease}
.version-info{margin-top:40px;padding:25px;background:rgba(108,99,255,.12);border-radius:18px}
.avatar-viewer{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:3000;justify-content:center;align-items:center;cursor:pointer}
.avatar-viewer img{max-width:80vw;max-height:80vh;min-width:400px;min-height:400px;border-radius:24px;object-fit:contain}
@media (max-width:768px){.mobile-warning{display:flex!important}.header,.main-content,.sidebar{display:none!important}}
@media (max-width:900px){.launch-methods{grid-template-columns:1fr}}
</style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="font-default">
<div class="mobile-warning"><div><h1>Access Denied</h1><p>Fragment Launcher is optimized for PC only. Please open on a computer.</p></div></div>
<div class="header">
<button class="menu-btn" onclick="playSound('click'); toggleSidebar()">‚ò∞</button>
<div class="logo" onclick="playSound('click'); navigateTo('main')">Fragment</div>
<div class="search-container">
<input type="text" class="search-input" id="searchInput" placeholder="Search games & accounts..." oninput="search()">
<div class="search-results" id="searchResults"></div>
</div>
<button class="account-btn" id="accountBtn" onclick="playSound('click'); openAccountModal()">+</button>
</div>
<div class="sidebar" id="sidebar">
<div>
<div class="sidebar-item" onclick="playSound('click'); navigateTo('main')">Main</div>
<div class="sidebar-item" onclick="playSound('click'); navigateTo('library')">Library</div>
<div class="sidebar-item" onclick="playSound('click'); navigateTo('profile')">Profile</div>
<div class="sidebar-item" onclick="playSound('click'); navigateTo('faq')">FAQ</div>
<div class="sidebar-item" onclick="playSound('click'); navigateTo('settings')">Settings</div>
</div>
<div class="sidebar-footer">
<a class="support-link" href="#" onclick="openSupportLink()">Tech Support / –¢–µ—Ö. –ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
<div class="copyright">¬© ouForge, 2026 –≥.</div>
</div>
</div>
<div class="main-content">
<!-- Main Page -->
<div id="mainPage">
<div class="featured-game">
<img src="https://images.unsplash.com/photo-1542751371-adc38448a05e?w=1200" alt="Featured">
<div class="featured-overlay">
<div class="featured-title">Cyberpunk 2077</div>
<div style="font-size:18px;color:#d0d0d0">Discover the world of the future</div>
</div>
</div>
<div class="games-section">
<div class="games-header">
<h2 style="font-size:32px">Games</h2>
<button class="random-game-btn" onclick="playSound('click'); openRandomGame()">üé≤ Random Game</button>
</div>
<div class="games-grid" id="gamesGrid"></div>
</div>
</div>

<!-- Game Page -->
<div class="game-page" id="gamePage">
<img class="game-banner" id="gameBanner" src="" alt="">
<div class="game-header">
<div class="game-avatar-container">
<img class="game-avatar" id="gameAvatar" src="" alt="">
<div class="game-id-display" id="gameIdDisplay"></div>
</div>
<div class="game-info">
<div class="game-title-wrapper">
<div class="game-title" id="gameTitle"></div>
<div id="gameBadge"></div>
</div>
<div class="playtime-container">
<div class="playtime-display" id="playtimeDisplay"><span>0.0 hours played</span></div>
<button class="playtime-btn" onclick="playSound('click'); addPlaytime()" title="Add time">+</button>
<button class="playtime-remove-btn" onclick="playSound('click'); removePlaytime()" title="Remove time">‚àí</button>
<div class="last-played" id="lastPlayedDisplay"></div>
</div>
<div class="game-actions">
<button class="btn" id="addToLibraryBtn" onclick="playSound('click'); addToLibrary()"></button>
<button class="btn" id="downloadBtn" style="display:none" onclick="playSound('click'); downloadGame()">Download</button>
<button class="settings-btn" id="exeSettingsBtn" style="display:none" onclick="playSound('click'); openExeSettings()">‚öôÔ∏è</button>
<button class="notes-btn" id="gameNotesBtn" onclick="playSound('click'); openNotes()">üìù</button>
</div>
</div>
</div>
<div class="section">
<div class="section-title" id="descTitle">Description</div>
<p id="gameDescription"></p>
</div>
<div class="section">
<div class="section-title" id="screenTitle">Screenshots</div>
<div class="gallery" id="gameGallery"></div>
</div>
<div class="section">
<div class="section-title" id="reqTitle">System Requirements</div>
<div class="requirements-toggle">
<button class="req-btn active" onclick="playSound('click'); toggleRequirements('min')">Minimum</button>
<button class="req-btn" onclick="playSound('click'); toggleRequirements('rec')">Recommended</button>
</div>
<div class="requirements active" id="minReq"></div>
<div class="requirements" id="recReq"></div>
</div>
<div class="section">
<div class="section-title" id="reviewsTitle">Reviews</div>
<div class="reviews-section" id="reviewsSection"></div>
</div>
</div>

<!-- Library Page -->
<div class="game-page" id="libraryPage">
<h1 style="font-size:42px;margin-bottom:30px" id="libTitle">Library</h1>
<div class="games-grid" id="libraryGrid"></div>
</div>

<!-- FAQ Page -->
<div class="game-page" id="faqPage">
<h1 style="font-size:42px;margin-bottom:30px">FAQ</h1>
<div class="faq-container" id="faqContainer"></div>
</div>

<!-- Profile Page -->
<div class="game-page" id="profilePage">
<h1 style="font-size:42px;margin-bottom:30px" id="profTitle">Profile</h1>
<div id="profileSection" style="display:none">
<div class="account-profile">
<div class="profile-avatar-wrapper">
<img class="profile-avatar" id="profileAvatar" src="" alt="Avatar" onclick="viewAvatar(this.src)">
<div class="avatar-edit-icon" onclick="openAvatarChangeModal()">‚úèÔ∏è</div>
</div>
<div style="flex:1">
<div class="profile-name"><span id="profileName"></span><img class="profile-badge" id="profileBadge" src="" alt="" style="display:none" onclick="handleBadgeClick()"></div>
<div class="level-container" id="levelContainer"></div>
<div class="profile-created" id="profileCreated"></div>
<div class="profile-stats" id="profileStats"></div>
<button class="profile-telegram" id="profileTelegram" onclick="playSound('click'); openTelegram()" style="display:none"><span>üì±</span><span>Telegram</span></button>
</div>
</div>

<!-- Charts -->
<div class="section">
    <div class="section-title" id="chartTitle">Activity (Last 14 Days)</div>
    <div class="chart-wrapper">
        <div class="chart-y-axis" id="chartYAxis"></div>
        <div class="chart-container" id="activityChart"></div>
    </div>
    
    <div class="recent-activity">
        <h3 style="margin-bottom:15px" id="recentTitle">Recent Activity</h3>
        <div class="recent-list" id="recentActivity"></div>
    </div>
    <div class="profile-uid" id="userUidDisplay"></div>
</div>

</div>
<div id="profileLoginPrompt" style="text-align:center;padding:50px">
<h2 style="margin-bottom:20px" id="needLoginTitle">You need to login</h2>
<button class="btn" onclick="openAccountModal()">Login</button>
</div>
</div>

<!-- Settings Page -->
<div class="game-page" id="settingsPage">
<h1 style="font-size:42px;margin-bottom:30px" id="settTitle">Settings</h1>
<div class="section">
<div class="settings-group">
<label id="languageLabel">Language / –Ø–∑—ã–∫</label>
<select id="languageSelect" onchange="changeLanguage()">
<option value="en">English</option>
<option value="ru">–†—É—Å—Å–∫–∏–π</option>
</select>
</div>
<div class="settings-group">
<label>Theme</label>
<select id="themeSelect" onchange="changeTheme()">
<option value="dark">Dark</option>
<option value="light">Light</option>
<option value="neon">Neon (Beta)</option>
</select>
</div>
<div class="settings-group">
<label>Interface Style</label>
<select id="styleSelect" onchange="changeStyle()">
<option value="standard">Standard</option>
<option value="cosmic">Cosmic Style</option>
</select>
</div>
<div class="settings-group">
<label>Font Family</label>
<select id="fontSelect" onchange="changeFont()">
<option value="default">Default</option>
<option value="monospace">Monospace</option>
<option value="rounded">Rounded</option>
</select>
</div>
<div class="settings-group">
<label>Interface Size</label>
<select id="sizeSelect" onchange="changeSize()">
<option value="compact">Compact</option>
<option value="normal">Normal</option>
<option value="large">Large</option>
</select>
</div>
<div class="settings-group">
<label id="soundVolumeLabel">Sound Volume: 100%</label>
<input type="range" min="0" max="100" value="100" class="range-slider" id="volumeSlider" oninput="changeVolume()">
</div>
<div class="settings-group">
<label>Game Title Style</label>
<select id="titleStyleSelect" onchange="changeTitleStyle()">
<option value="outlined">White with Black Outline</option>
<option value="gradient">Gradient</option>
<option value="custom">Custom Color</option>
</select>
</div>
<div class="settings-group" id="customColorGroup" style="display:none">
<label>Custom Title Color</label>
<input type="color" id="customColorPicker" onchange="changeTitleStyle()" value="#ffffff">
</div>
<div class="settings-group" id="logoutGroup" style="display:none">
<button class="btn btn-secondary" onclick="playSound('click'); logout()" style="width:100%">Logout</button>
</div>
<div class="backup-section">
<div class="backup-title" id="backupTitle" onclick="handleBackupClick()">üíæ Backup & Restore</div>
<p style="color:var(--text-secondary);margin-bottom:10px">Save all your data</p>
<div class="backup-buttons">
<button class="backup-btn" onclick="playSound('click'); exportBackup()">üì• Export</button>
<button class="backup-btn" onclick="playSound('click'); document.getElementById('importFile').click()">üì§ Import</button>
<input type="file" id="importFile" accept=".json" style="display:none" onchange="importBackup(event)">
</div>
</div>
<div class="version-info">
<h3>Fragment Launcher v0.1.0 (Release)</h3>
<ul style="color:var(--text-secondary);margin-top:10px;padding-left:20px">
<li>‚ö° PWA Support</li>
<li>üîä Sound Effects</li>
<li>üåç Full Russian Translation</li>
<li>üé® New Level Designs (25-50+)</li>
<li>üëë Prime Status & UIDs</li>
<li>‚ùì FAQ Section</li>
<li>üìä Enhanced Activity Chart</li>
</ul>
</div>
</div>
</div>
</div>

<!-- Modals -->
<div class="modal" id="accountModal">
<div class="modal-content">
<button class="modal-close" onclick="closeAccountModal()">√ó</button>
<div class="modal-title">Login</div>
<div class="form-group">
<label>Login</label>
<input type="text" id="loginInput">
</div>
<div class="form-group">
<label>Password</label>
<input type="password" id="passwordInput">
</div>
<button class="btn" onclick="playSound('click'); login()" style="width:100%;margin-top:20px">Login</button>
</div>
</div>

<div class="modal" id="notesModal">
<div class="modal-content">
<button class="modal-close" onclick="closeNotesModal()">√ó</button>
<div class="modal-title" id="notesTitle">Game Notes</div>
<div class="form-group">
<label>Your Notes</label>
<textarea id="gameNotesInput" rows="10" placeholder="Write your strategies, keys, or thoughts here..."></textarea>
</div>
<button class="btn" onclick="playSound('click'); saveNotes()" style="width:100%" id="saveNoteBtn">Save Note</button>
</div>
</div>

<div class="modal" id="badgeModal">
<div class="modal-content" style="max-width:400px;text-align:center">
<button class="modal-close" onclick="document.getElementById('badgeModal').style.display='none'">√ó</button>
<div class="modal-title">Badge Info</div>
<p id="badgeModalText" style="font-size:18px;line-height:1.6"></p>
</div>
</div>

<div class="modal" id="accountViewModal">
<div class="modal-content">
<button class="modal-close" onclick="closeAccountViewModal()">√ó</button>
<div class="modal-title">User Profile</div>
<div class="account-profile" style="margin:0">
<img class="profile-avatar" id="viewProfileAvatar" src="" onclick="viewAvatar(this.src)">
<div style="flex:1">
<div class="profile-name"><span id="viewProfileName"></span></div>
<div class="level-container" id="viewLevelContainer" style="margin-bottom:10px"></div>
<div class="profile-created" id="viewProfileCreated"></div>
<div class="profile-uid" id="viewProfileUid" style="text-align:left;margin-top:5px;display:none"></div>
<button class="profile-telegram" id="viewProfileTelegram" onclick="openViewTelegram()" style="display:none"><span>üì±</span><span>Contact</span></button>
</div>
</div>
</div>
</div>
<div class="modal" id="avatarChangeModal">
<div class="modal-content" style="max-width:500px">
<button class="modal-close" onclick="closeAvatarChangeModal()">√ó</button>
<div class="modal-title">Change Avatar</div>
<p style="color:var(--text-secondary);margin-bottom:20px">Click the button below to change your avatar via bot</p>
<button class="btn" onclick="playSound('click'); openAvatarBot()" style="width:100%">Open Avatar Bot</button>
</div>
</div>
<div class="modal" id="exeModal">
<div class="modal-content">
<button class="modal-close" onclick="closeExeModal()">√ó</button>
<div class="modal-title" id="exeModalTitle">Launch Setup</div>
<div class="launch-methods">
<div class="launch-method">
<div class="method-title" id="method1Title">üñ•Ô∏è Desktop Shortcut</div>
<ol style="line-height:2;padding-left:20px" id="method1Steps">
<li>Right-click Desktop</li>
<li>New ‚Üí Shortcut</li>
<li>Browse for .exe</li>
<li>Name it and done!</li>
</ol>
</div>
<div class="launch-method">
<div class="method-title" id="method2Title">üìÇ Manual Path</div>
<ol style="line-height:2;padding-left:20px" id="method2Steps">
<li>Open File Explorer</li>
<li>Find game folder</li>
<li>Shift + Right-click .exe</li>
<li>"Copy as path"</li>
<li>Paste below</li>
</ol>
</div>
</div>
<div style="margin-top:20px">
<label style="display:block;margin-bottom:10px" id="exePathLabel">Game Path:</label>
<input type="text" id="exePath" placeholder="C:\Games\game.exe" style="width:100%;background:rgba(45,45,50,.7);border:1px solid var(--glass-border);padding:12px;border-radius:14px;color:var(--text-primary)">
</div>
<div style="display:flex;gap:15px;margin-top:30px">
<button class="btn btn-secondary" onclick="closeExeModal()" id="exeCancelBtn">Cancel</button>
<button class="btn" onclick="playSound('click'); saveExePath()" id="exeSaveBtn">Save</button>
</div>
</div>
</div>
<div class="modal" id="playtimeModal">
<div class="modal-content" style="max-width:400px">
<button class="modal-close" onclick="closePlaytimeModal()">√ó</button>
<div class="modal-title">Add Playtime</div>
<div class="form-group">
<label>Minutes</label>
<input type="number" id="playtimeInput" value="30" min="1">
</div>
<div style="display:flex;gap:15px;margin-top:30px">
<button class="btn btn-secondary" onclick="closePlaytimeModal()">Cancel</button>
<button class="btn" onclick="playSound('click'); savePlaytime()">Add</button>
</div>
</div>
</div>
<div class="modal" id="launchModal">
<div class="modal-content" style="max-width:600px">
<button class="modal-close" onclick="closeLaunchModal()">√ó</button>
<div class="modal-title" id="launchModalTitle">Launch Instructions</div>
<div style="background:rgba(45,45,50,.4);padding:20px;border-radius:16px;margin-bottom:20px">
<p id="launchStep1" style="margin-bottom:10px">1. Open Command Prompt (Win + R, type 'cmd')</p>
<p id="launchStep2" style="margin-bottom:10px">2. Copy the command below:</p>
<div style="background:rgba(0,0,0,.5);padding:15px;border-radius:12px;margin:15px 0;font-family:monospace;word-break:break-all;position:relative">
<code id="launchCommand" style="color:#4caf50"></code>
</div>
<button class="btn" onclick="playSound('click'); copyLaunchCommand()" style="width:100%;margin-bottom:10px" id="copyCommandBtn">Copy Command</button>
<p id="launchStep3">3. Paste it into Command Prompt and press Enter</p>
</div>
<button class="btn btn-secondary" onclick="closeLaunchModal()" style="width:100%">Close</button>
</div>
</div>
<div class="avatar-viewer" id="avatarViewer" onclick="closeAvatarViewer()">
<img id="avatarViewerImg" src="" alt="">
</div>
<script>
// Sound Assets (Base64 for offline compat)
const sounds = {
    click: "data:audio/wav;base64,UklGRiYAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=", // Placeholder, will be replaced by generated short beep if needed, but for 'Release' a real tiny sound is better. I will simulate a short click.
    // Actually, empty base64 won't play. Using a tiny valid wav beep.
    click_real: "data:audio/wav;base64,UklGRl9vT1ZAVkZXRm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU"+Array(20).join("A"), // Still placeholder logic, implementing simple oscillator below instead for reliability without huge strings.
};
// Sound Logic
let audioContext = null;
let masterVolume = 1;

function initAudio() { if(!audioContext) audioContext = new (window.AudioContext || window.webkitAudioContext)(); }
function playSound(type) {
    if(!audioContext) initAudio();
    if(masterVolume <= 0) return;
    const osc = audioContext.createOscillator();
    const gain = audioContext.createGain();
    osc.connect(gain);
    gain.connect(audioContext.destination);
    
    if(type === 'click') {
        osc.frequency.setValueAtTime(600, audioContext.currentTime);
        osc.frequency.exponentialRampToValueAtTime(300, audioContext.currentTime + 0.1);
        gain.gain.setValueAtTime(0.1 * masterVolume, audioContext.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        osc.start(); osc.stop(audioContext.currentTime + 0.1);
    }
}

const translations={
    en:{main:"Main",library:"Library",profile:"Profile",settings:"Settings",faq:"FAQ",search:"Search games & accounts...",login:"Login",password:"Password",loginBtn:"Login",logout:"Logout",theme:"Theme",dark:"Dark",light:"Light",neon:"Neon (Beta)",interfaceStyle:"Interface Style",standard:"Standard",cosmic:"Cosmic Style",fontFamily:"Font Family",default:"Default",monospace:"Monospace",rounded:"Rounded",interfaceSize:"Interface Size",compact:"Compact",normal:"Normal",large:"Large",titleStyle:"Game Title Style",outlined:"White with Black Outline",gradient:"Gradient",customColor:"Custom Color",customTitleColor:"Custom Title Color",backup:"Backup & Restore",backupDesc:"Save all your data",export:"Export",import:"Import",addToLibrary:"Add to Library",removeFromLibrary:"Remove",download:"Download",launch:"Launch",launchInstructions:"Launch Instructions",launchStep1:"1. Open Command Prompt (Win + R, type 'cmd')",launchStep2:"2. Copy the command below:",launchStep3:"3. Paste it into Command Prompt and press Enter",copyCommand:"Copy Command",commandCopied:"Command copied!",description:"Description",screenshots:"Screenshots",systemReq:"System Requirements",minimum:"Minimum",recommended:"Recommended",reviews:"Reviews",hoursPlayed:"hours played",addTime:"Add Time",removeTime:"Remove Time",launchSetup:"Launch Setup",desktopShortcut:"Desktop Shortcut",manualPath:"Manual Path",desktopStep1:"Right-click Desktop",desktopStep2:"New ‚Üí Shortcut",desktopStep3:"Browse for .exe",desktopStep4:"Name it and done!",manualStep1:"Open File Explorer",manualStep2:"Find game folder",manualStep3:"Shift + Right-click .exe",manualStep4:'"Copy as path"',manualStep5:"Paste below",gamePath:"Game Path:",cancel:"Cancel",save:"Save",minutes:"Minutes",loggedIn:"Logged in!",loggedOut:"Logged out",invalid:"Invalid!",saved:"Saved!",exported:"Exported!",imported:"Imported! Reloading...",invalidFile:"Invalid file!",empty:"Empty",nothingFound:"Nothing found",game:"Game",account:"Account",created:"Created",userProfile:"User Profile",contact:"Contact",totalPlaytime:"Total Playtime",devModeOn:"You activated developer mode",devModeOff:"You deactivated developer mode",randomGame:"Random Game",changeAvatar:"Change Avatar",changeAvatarDesc:"Click the button below to change your avatar via bot",openBot:"Open Avatar Bot",soundVolume:"Sound Volume",libraryStats:"{count} Games in Library",chartTitle:"Activity (Last 14 Days)",recentTitle:"Recent Activity",notesTitle:"Game Notes",notesPlaceholder:"Write your strategies, keys, or thoughts here...",saveNote:"Save Note",lastPlayed:"Last played: {date}",needLogin:"You need to login"},
    ru:{main:"–ì–ª–∞–≤–Ω–∞—è",library:"–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞",profile:"–ü—Ä–æ—Ñ–∏–ª—å",settings:"–ù–∞—Å—Ç—Ä–æ–π–∫–∏",faq:"FAQ",search:"–ü–æ–∏—Å–∫ –∏–≥—Ä –∏ –∞–∫–∫–∞—É–Ω—Ç–æ–≤...",login:"–õ–æ–≥–∏–Ω",password:"–ü–∞—Ä–æ–ª—å",loginBtn:"–í–æ–π—Ç–∏",logout:"–í—ã–π—Ç–∏",theme:"–¢–µ–º–∞",dark:"–¢–µ–º–Ω–∞—è",light:"–°–≤–µ—Ç–ª–∞—è",neon:"–ù–µ–æ–Ω (–ë–µ—Ç–∞)",interfaceStyle:"–°—Ç–∏–ª—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞",standard:"–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π",cosmic:"–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å",fontFamily:"–®—Ä–∏—Ñ—Ç",default:"–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é",monospace:"–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–π",rounded:"–û–∫—Ä—É–≥–ª—ã–π",interfaceSize:"–†–∞–∑–º–µ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞",compact:"–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π",normal:"–û–±—ã—á–Ω—ã–π",large:"–ë–æ–ª—å—à–æ–π",titleStyle:"–°—Ç–∏–ª—å –Ω–∞–∑–≤–∞–Ω–∏—è –∏–≥—Ä",outlined:"–ë–µ–ª—ã–π —Å —á–µ—Ä–Ω—ã–º –∫–æ–Ω—Ç—É—Ä–æ–º",gradient:"–ì—Ä–∞–¥–∏–µ–Ω—Ç",customColor:"–°–≤–æ–π —Ü–≤–µ—Ç",customTitleColor:"–°–≤–æ–π —Ü–≤–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è",backup:"–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ",backupDesc:"–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ",export:"–≠–∫—Å–ø–æ—Ä—Ç",import:"–ò–º–ø–æ—Ä—Ç",addToLibrary:"–î–æ–±–∞–≤–∏—Ç—å –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É",removeFromLibrary:"–£–¥–∞–ª–∏—Ç—å",download:"–°–∫–∞—á–∞—Ç—å",launch:"–ó–∞–ø—É—Å—Ç–∏—Ç—å",launchInstructions:"–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É",launchStep1:"1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É (Win + R, –≤–≤–µ–¥–∏—Ç–µ 'cmd')",launchStep2:"2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –Ω–∏–∂–µ:",launchStep3:"3. –í—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É –∏ –Ω–∞–∂–º–∏—Ç–µ Enter",copyCommand:"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É",commandCopied:"–ö–æ–º–∞–Ω–¥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!",description:"–û–ø–∏—Å–∞–Ω–∏–µ",screenshots:"–°–∫—Ä–∏–Ω—à–æ—Ç—ã",systemReq:"–°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è",minimum:"–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ",recommended:"–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ",reviews:"–û—Ç–∑—ã–≤—ã",hoursPlayed:"—á–∞—Å–æ–≤ —Å—ã–≥—Ä–∞–Ω–æ",addTime:"–î–æ–±–∞–≤–∏—Ç—å –≤—Ä–µ–º—è",removeTime:"–£–±—Ä–∞—Ç—å –≤—Ä–µ–º—è",launchSetup:"–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–ø—É—Å–∫–∞",desktopShortcut:"–Ø—Ä–ª—ã–∫ –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ",manualPath:"–†—É—á–Ω–æ–π –ø—É—Ç—å",desktopStep1:"–ü–ö–ú –Ω–∞ —Ä–∞–±–æ—á–µ–º —Å—Ç–æ–ª–µ",desktopStep2:"–°–æ–∑–¥–∞—Ç—å ‚Üí –Ø—Ä–ª—ã–∫",desktopStep3:"–û–±–∑–æ—Ä –¥–ª—è .exe",desktopStep4:"–ù–∞–∑–æ–≤–∏—Ç–µ –∏ –≥–æ—Ç–æ–≤–æ!",manualStep1:"–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫",manualStep2:"–ù–∞–π–¥–∏—Ç–µ –ø–∞–ø–∫—É –∏–≥—Ä—ã",manualStep3:"Shift + –ü–ö–ú –Ω–∞ .exe",manualStep4:'"–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∫ –ø—É—Ç—å"',manualStep5:"–í—Å—Ç–∞–≤—å—Ç–µ –Ω–∏–∂–µ",gamePath:"–ü—É—Ç—å –∫ –∏–≥—Ä–µ:",cancel:"–û—Ç–º–µ–Ω–∞",save:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å",minutes:"–ú–∏–Ω—É—Ç—ã",loggedIn:"–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!",loggedOut:"–í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω",invalid:"–ù–µ–≤–µ—Ä–Ω–æ!",saved:"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!",exported:"–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ!",imported:"–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ! –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞...",invalidFile:"–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–∞–π–ª!",empty:"–ü—É—Å—Ç–æ",nothingFound:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",game:"–ò–≥—Ä–∞",account:"–ê–∫–∫–∞—É–Ω—Ç",created:"–°–æ–∑–¥–∞–Ω",userProfile:"–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",contact:"–°–≤—è–∑–∞—Ç—å—Å—è",totalPlaytime:"–í—Å–µ–≥–æ –Ω–∞–∏–≥—Ä–∞–Ω–æ",devModeOn:"–í—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞",devModeOff:"–í—ã –æ—Ç–∫–ª—é—á–∏–ª–∏ —Ä–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞",randomGame:"–°–ª—É—á–∞–π–Ω–∞—è –∏–≥—Ä–∞",changeAvatar:"–ò–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É",changeAvatarDesc:"–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä–∫—É —á–µ—Ä–µ–∑ –±–æ—Ç–∞",openBot:"–û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞",soundVolume:"–ì—Ä–æ–º–∫–æ—Å—Ç—å –∑–≤—É–∫–∞",libraryStats:"{count} –∏–≥—Ä –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ",chartTitle:"–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (14 –¥–Ω–µ–π)",recentTitle:"–ù–µ–¥–∞–≤–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",notesTitle:"–ó–∞–º–µ—Ç–∫–∏ –∫ –∏–≥—Ä–µ",notesPlaceholder:"–ù–∞–ø–∏—à–∏—Ç–µ –∑–¥–µ—Å—å —Å–≤–æ–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏, –∫–ª—é—á–∏ –∏–ª–∏ –º—ã—Å–ª–∏...",saveNote:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É",lastPlayed:"–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫: {date}",needLogin:"–í–∞–º –Ω—É–∂–Ω–æ –≤–æ–π—Ç–∏"}
};
let currentLang='en',devModeClicks=0,devModeTimeout=null;
// Added UIDs and Prime status (0 or 1)
const accounts = [
    {uid: 1001, login: "oulan", password: "oulan2008", nickname: "oulan", avatar: "https://i-mg24.ru/images/122025214036-rix6n.gif", badge: "https://i-mg24.ru/images/122025220553-so5hj.png", badgeText: "oulan", telegram: "https://t.me/oulan1", created: "2025-12-10", exp: 100000, prime: 1},
    {uid: 1002, login: "d1sqw", password: "test123", nickname: "M", avatar: "https://i-mg24.ru/images/122125103126-s3pjz.jpg", badge: "https://img.icons8.com/emoji/48/fire.png", badgeText: "Early Tester", telegram: "https://t.me/d1sqw", created: "2025-12-21", exp: 50, prime: 0},
    {uid: 1003, login: "user2", password: "user2pass", nickname: "CasualPlayer", avatar: "https://i.pravatar.cc/150?img=3", badge: "", badgeText: "", telegram: "", created: "2024-06-10", exp: 0, prime: 0}
];
const games = [
    {id: 1, title: "People Playground", shortDesc: "18+ sandbox", description: "Welcome to People Playground!", banner: "https://shared.fastly.steamstatic.com/store_item_assets/steam/apps/1118200/header.jpg?t=1763123186", avatar: "https://gfn.am/en/games/media/images/art_im_wa7r9Xc.2e16d0ba.fill-308x308.format-webp.webpquality-50.webp", gallery: ["https://gfn.am/en/games/media/images/scree_x68WEwr.2e16d0ba.fill-1152x648.format-webp.webpquality-50.webp", "https://gfn.am/en/games/media/images/scree_gJ8zkub.2e16d0ba.fill-1152x648.format-webp.webpquality-50.webp"], downloadUrl: "https://drive.usercontent.google.com/download", minReq: "OS: Windows 7 SP2+<br>CPU: 2 GHz<br>RAM: 4GB", recReq: "OS: Windows 10<br>CPU: 3 GHz<br>RAM: 8GB", update: 1, updateDate: "2025-12-21", updateVersion: "27.3", reviews: [{author: "Admin", avatar: "https://i.pravatar.cc/150?img=1", rating: 5, date: "2024-12-01", text: "Amazing game!"}]},
    {id: 2, title: "The Witcher 3", shortDesc: "Fantasy RPG", description: "Monster hunter adventure", banner: "https://images.unsplash.com/photo-1511512578047-dfb367046420?w=1200", avatar: "https://images.unsplash.com/photo-1511512578047-dfb367046420?w=300", gallery: ["https://images.unsplash.com/photo-1511512578047-dfb367046420?w=400"], downloadUrl: "https://example.com", minReq: "OS: Win7<br>CPU: i5", recReq: "OS: Win10<br>CPU: i7", update: 0, updateDate: "", updateVersion: "", reviews: []},
    {id: 3, title: "Elden Ring", shortDesc: "Dark fantasy", description: "Explore the Lands Between", banner: "https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=1200", avatar: "https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=300", gallery: ["https://images.unsplash.com/photo-1538481199705-c710c4e965fc?w=400"], downloadUrl: "https://example.com", minReq: "OS: Win10<br>CPU: i5", recReq: "OS: Win10<br>CPU: i7", update: 1, updateDate: "2024-12-05", updateVersion: "1.10", reviews: []}
];

const faqItems = [
    {q: {en: "How to add games?", ru: "–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä—ã?"}, a: {en: "Click 'Add to Library' on any game page.", ru: "–ù–∞–∂–º–∏—Ç–µ '–î–æ–±–∞–≤–∏—Ç—å –≤ –±–∏–±–ª–∏–æ—Ç–µ–∫—É' –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª—é–±–æ–π –∏–≥—Ä—ã."}},
    {q: {en: "Where are my saves?", ru: "–ì–¥–µ –º–æ–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è?"}, a: {en: "Backup your data in Settings.", ru: "–°–¥–µ–ª–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –¥–∞–Ω–Ω—ã—Ö –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö."}},
    {q: {en: "What is Prime Status?", ru: "–ß—Ç–æ —Ç–∞–∫–æ–µ Prime —Å—Ç–∞—Ç—É—Å?"}, a: {en: "Prime status gives you a golden name and supports the developer.", ru: "Prime —Å—Ç–∞—Ç—É—Å –¥–µ–ª–∞–µ—Ç –≤–∞—à–µ –∏–º—è –∑–æ–ª–æ—Ç—ã–º –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞."}}
];

let currentGame = null;
let currentViewAccount = null;

window.addEventListener('popstate', function(event) {
    if (event.state) {
        if (event.state.page === 'game' && event.state.gameId) {
            showGame(event.state.gameId, false);
        } else if (event.state.page) {
            showPage(event.state.page, false);
        }
    } else {
        showPage('main', false);
    }
});

function navigateTo(page, gameId = null) {
    if (page === 'game' && gameId) {
        showGame(gameId, true);
    } else {
        showPage(page, true);
    }
}

function loadData(){
    if(!localStorage.getItem('library'))localStorage.setItem('library',JSON.stringify([]));
    if(!localStorage.getItem('exePaths'))localStorage.setItem('exePaths',JSON.stringify({}));
    if(!localStorage.getItem('playtime'))localStorage.setItem('playtime',JSON.stringify({}));
    if(!localStorage.getItem('lastPlayed'))localStorage.setItem('lastPlayed',JSON.stringify({}));
    if(!localStorage.getItem('gameNotes'))localStorage.setItem('gameNotes',JSON.stringify({}));
    if(!localStorage.getItem('dailyPlaytime'))localStorage.setItem('dailyPlaytime',JSON.stringify({}));
    if(!localStorage.getItem('recentGames'))localStorage.setItem('recentGames',JSON.stringify([]));

    if(!localStorage.getItem('devMode'))localStorage.setItem('devMode','false');
    if(!localStorage.getItem('titleStyle'))localStorage.setItem('titleStyle','outlined');
    if(!localStorage.getItem('customTitleColor'))localStorage.setItem('customTitleColor','#ffffff');
    if(!localStorage.getItem('soundVolume'))localStorage.setItem('soundVolume','100');
    
    currentLang=localStorage.getItem('language')||'en';
    masterVolume = parseInt(localStorage.getItem('soundVolume')) / 100;
    document.getElementById('volumeSlider').value = localStorage.getItem('soundVolume');
    document.getElementById('languageSelect').value=currentLang;
    
    applyTheme(localStorage.getItem('theme')||'dark');
    applyStyle(localStorage.getItem('style')||'standard');
    applyFont(localStorage.getItem('font')||'default');
    applySize(localStorage.getItem('size')||'normal');
    
    document.getElementById('themeSelect').value=localStorage.getItem('theme')||'dark';
    document.getElementById('styleSelect').value=localStorage.getItem('style')||'standard';
    document.getElementById('fontSelect').value=localStorage.getItem('font')||'default';
    document.getElementById('sizeSelect').value=localStorage.getItem('size')||'normal';
    document.getElementById('titleStyleSelect').value=localStorage.getItem('titleStyle')||'outlined';
    document.getElementById('customColorPicker').value=localStorage.getItem('customTitleColor')||'#ffffff';
    
    if(localStorage.getItem('titleStyle')==='custom')document.getElementById('customColorGroup').style.display='block';
    
    checkAuth();
    renderGames();
    updateUI();
    createSnowflakes();
    
    if (!history.state) {
        history.replaceState({page: 'main'}, '', '#main');
    }
}

function changeLanguage(){currentLang=document.getElementById('languageSelect').value;localStorage.setItem('language',currentLang);updateUI();updateSettingsLabels();checkAuth();renderFAQ();}
function changeVolume(){
    const val = document.getElementById('volumeSlider').value;
    localStorage.setItem('soundVolume', val);
    masterVolume = val / 100;
    updateSettingsLabels();
}
function updateSettingsLabels(){
    const t=translations[currentLang];
    document.querySelectorAll('.settings-group label').forEach((label, i) => {
        if(i===1)label.textContent=t.theme;
        if(i===2)label.textContent=t.interfaceStyle;
        if(i===3)label.textContent=t.fontFamily;
        if(i===4)label.textContent=t.interfaceSize;
        if(i===5)label.textContent=t.soundVolume + ': ' + (masterVolume*100).toFixed(0) + '%';
        if(i===6)label.textContent=t.titleStyle;
        if(i===7)label.textContent=t.customTitleColor;
    });
}
function updateUI(){const t=translations[currentLang];document.querySelectorAll('.sidebar-item')[0].textContent=t.main;document.querySelectorAll('.sidebar-item')[1].textContent=t.library;document.querySelectorAll('.sidebar-item')[2].textContent=t.profile;document.querySelectorAll('.sidebar-item')[3].textContent=t.faq;document.querySelectorAll('.sidebar-item')[4].textContent=t.settings;document.getElementById('searchInput').placeholder=t.search;document.querySelector('.random-game-btn').innerHTML=`üé≤ ${t.randomGame}`;updateSettingsLabels();const logoutBtn=document.querySelector('#logoutGroup .btn');if(logoutBtn)logoutBtn.textContent=t.logout;document.querySelector('.backup-title').textContent=`üíæ ${t.backup}`;document.querySelector('.backup-section p').textContent=t.backupDesc;const backupBtns=document.querySelectorAll('.backup-btn');if(backupBtns[0])backupBtns[0].innerHTML=`üì• ${t.export}`;if(backupBtns[1])backupBtns[1].innerHTML=`üì§ ${t.import}`;document.getElementById('exeModalTitle').textContent=t.launchSetup;document.getElementById('method1Title').textContent=`üñ•Ô∏è ${t.desktopShortcut}`;document.getElementById('method2Title').textContent=`üìÇ ${t.manualPath}`;document.getElementById('exePathLabel').textContent=t.gamePath;document.getElementById('exeCancelBtn').textContent=t.cancel;document.getElementById('exeSaveBtn').textContent=t.save;
document.getElementById('chartTitle').textContent=t.chartTitle;document.getElementById('recentTitle').textContent=t.recentTitle;document.getElementById('profTitle').textContent=t.profile;document.getElementById('libTitle').textContent=t.library;document.getElementById('settTitle').textContent=t.settings;document.getElementById('notesTitle').textContent=t.notesTitle;document.getElementById('gameNotesInput').placeholder=t.notesPlaceholder;document.getElementById('saveNoteBtn').textContent=t.saveNote;document.getElementById('descTitle').textContent=t.description;document.getElementById('screenTitle').textContent=t.screenshots;document.getElementById('reqTitle').textContent=t.systemReq;document.getElementById('reviewsTitle').textContent=t.reviews;document.getElementById('needLoginTitle').textContent=t.needLogin;
}

function calculateLevel(exp) {
    let level = 1;
    let totalReq = 5;
    let step = 5;
    while (exp >= totalReq) {
        level++;
        step = step * 1.15;
        step = Math.ceil(step);
        if (step % 2 !== 0) step++;
        totalReq += step;
    }
    return { level, nextReq: totalReq };
}

function getLevelClass(level) {
    if (level < 5) return 'lvl-white';
    if (level < 10) return 'lvl-yellow';
    if (level < 20) return 'lvl-orange';
    if (level < 25) return 'lvl-red'; // 20-24
    if (level < 30) return 'lvl-25'; // 25-29
    if (level < 35) return 'lvl-30'; // 30-34
    if (level < 40) return 'lvl-35'; // 35-39
    if (level < 45) return 'lvl-40'; // 40-44
    if (level < 50) return 'lvl-45'; // 45-49
    return 'lvl-50';
}

function checkAuth(){
    let u = JSON.parse(localStorage.getItem('currentUser'));
    if(u){
        const codeAccount = accounts.find(a => a.login === u.login);
        if (codeAccount) {
            u.exp = codeAccount.exp;
            u.badge = codeAccount.badge;
            u.badgeText = codeAccount.badgeText;
            u.avatar = codeAccount.avatar;
            u.prime = codeAccount.prime;
            u.uid = codeAccount.uid;
        }

        const btn=document.getElementById('accountBtn');
        btn.classList.add('logged-in');
        btn.innerHTML=`<img src="${u.avatar}">`;
        btn.onclick=()=>navigateTo('profile');
        document.getElementById('profileSection').style.display='block';
        document.getElementById('profileLoginPrompt').style.display='none';
        document.getElementById('logoutGroup').style.display='block';
        document.getElementById('profileAvatar').src=u.avatar;
        document.getElementById('profileName').textContent=u.nickname;
        document.getElementById('profileName').className = u.prime ? 'profile-name prime-user' : 'profile-name';
        
        const exp = u.exp || 0;
        const lvlData = calculateLevel(exp);
        const lvlClass = getLevelClass(lvlData.level);
        const lvlContainer = document.getElementById('levelContainer');
        
        let shapeContent = lvlData.level;
        if(lvlData.level >= 50) shapeContent = `<span class="lvl-text-gradient">${lvlData.level}</span>`;
        
        lvlContainer.innerHTML = `
            <div class="level-shape ${lvlClass}">${shapeContent}</div>
            <div class="level-info">
                <span style="font-weight:bold; color:var(--text-primary)">Level ${lvlData.level}</span>
                <span>${exp} / ${lvlData.nextReq} XP</span>
            </div>
        `;

        const profileBadge=document.getElementById('profileBadge');
        if(u.badge){profileBadge.src=u.badge;profileBadge.style.display='inline-block'}else{profileBadge.style.display='none'}
        document.getElementById('profileCreated').textContent=`${translations[currentLang].created}: ${u.created}`;
        document.getElementById('userUidDisplay').textContent = `UID: ${u.uid}`;
        
        const pt=JSON.parse(localStorage.getItem('playtime'));
        const total=Object.values(pt).reduce((a,b)=>a+b,0);
        const totalHours=(total/60).toFixed(1);
        
        const lib = JSON.parse(localStorage.getItem('library'));
        document.getElementById('profileStats').innerHTML=`${translations[currentLang].totalPlaytime}: ${totalHours} ${translations[currentLang].hoursPlayed}<br><span style="color:var(--text-secondary);font-size:14px">${translations[currentLang].libraryStats.replace('{count}', lib.length)}</span>`;
        
        if(u.telegram)document.getElementById('profileTelegram').style.display='inline-flex';
        document.querySelector('.profile-avatar-wrapper .avatar-edit-icon').style.display='flex';

        renderChart();
        renderRecent();
    }else{
        document.getElementById('profileSection').style.display='none';
        document.getElementById('profileLoginPrompt').style.display='block';
    }
}

function renderChart() {
    const daily = JSON.parse(localStorage.getItem('dailyPlaytime'));
    const chart = document.getElementById('activityChart');
    const yAxis = document.getElementById('chartYAxis');
    chart.innerHTML = '';
    yAxis.innerHTML = '';
    
    const today = new Date();
    let maxMin = 0;
    
    // Calc max
    for(let i=13; i>=0; i--){
        const d=new Date(); d.setDate(today.getDate()-i);
        const key=d.toISOString().split('T')[0];
        if(daily[key] > maxMin) maxMin = daily[key];
    }
    
    // Y-Axis Labels (0 to ceil(max hours))
    const maxHours = Math.max(1, Math.ceil(maxMin / 60));
    for(let i=maxHours; i>=0; i--){
        const d = document.createElement('div');
        d.textContent = i + 'h';
        yAxis.appendChild(d);
    }
    
    // Bars
    for (let i = 13; i >= 0; i--) {
        const d = new Date();
        d.setDate(today.getDate() - i);
        const dayStr = `${d.getDate()}.${d.getMonth()+1}`;
        const key = d.toISOString().split('T')[0];
        const minutes = daily[key] || 0;
        const hours = (minutes / 60).toFixed(1);
        
        let heightPct = (minutes / (maxHours * 60)) * 100;
        if(minutes > 0 && heightPct < 5) heightPct = 5;
        
        const barWrapper = document.createElement('div');
        barWrapper.className = 'chart-bar-wrapper';
        barWrapper.innerHTML = `
            <div class="chart-bar" style="height:${heightPct}%" title="${hours} ${translations[currentLang].hoursPlayed}"></div>
            <div class="chart-date">${dayStr}</div>
        `;
        chart.appendChild(barWrapper);
    }
}

function renderRecent() {
    const recent = JSON.parse(localStorage.getItem('recentGames'));
    const list = document.getElementById('recentActivity');
    list.innerHTML = '';
    
    recent.slice(0, 5).forEach(r => {
        const g = games.find(gm => gm.id === r.id);
        if(g) {
            const item = document.createElement('div');
            item.className = 'recent-item';
            const t = translations[currentLang];
            item.innerHTML = `<img src="${g.avatar}"><div><div style="font-weight:bold">${g.title}</div><div style="font-size:12px;color:var(--text-secondary)">${t.lastPlayed.replace('{date}', r.date)}</div></div>`;
            list.appendChild(item);
        }
    });
}

function renderFAQ() {
    const c = document.getElementById('faqContainer');
    c.innerHTML = '';
    faqItems.forEach(item => {
        const d = document.createElement('div');
        d.className = 'faq-item';
        d.innerHTML = `
            <div class="faq-question" onclick="this.parentElement.classList.toggle('active'); playSound('click')">
                <span>${item.q[currentLang]}</span>
                <i class="fas fa-chevron-down faq-icon"></i>
            </div>
            <div class="faq-answer">${item.a[currentLang]}</div>
        `;
        c.appendChild(d);
    });
}

function openAccountModal(){document.getElementById('accountModal').style.display='flex'}
function closeAccountModal(){document.getElementById('accountModal').style.display='none'}
function login(){const l=document.getElementById('loginInput').value;const p=document.getElementById('passwordInput').value;const u=accounts.find(a=>a.login===l&&a.password===p);if(u){const d={...u};delete d.password;localStorage.setItem('currentUser',JSON.stringify(d));closeAccountModal();checkAuth();alert(translations[currentLang].loggedIn)}else alert(translations[currentLang].invalid)}
function logout(){localStorage.removeItem('currentUser');document.getElementById('profileSection').style.display='none';document.getElementById('profileLoginPrompt').style.display='block';document.getElementById('logoutGroup').style.display='none';const btn=document.getElementById('accountBtn');btn.classList.remove('logged-in');btn.innerHTML='+';btn.onclick=openAccountModal;document.querySelector('.profile-avatar-wrapper .avatar-edit-icon').style.display='none';alert(translations[currentLang].loggedOut)}
function openAvatarChangeModal(){document.getElementById('avatarChangeModal').style.display='flex'}
function closeAvatarChangeModal(){document.getElementById('avatarChangeModal').style.display='none'}
function openAvatarBot(){window.open('https://t.me/your_avatar_bot','_blank');closeAvatarChangeModal()}
function handleBadgeClick(){
    const storedUser = JSON.parse(localStorage.getItem('currentUser'));
    if(!storedUser) return;
    
    // Sync with code-defined accounts to get latest badgeText
    const codeAccount = accounts.find(a => a.login === storedUser.login);
    const badgeText = codeAccount ? codeAccount.badgeText : storedUser.badgeText;

    if(badgeText){
        document.getElementById('badgeModalText').textContent = badgeText;
        document.getElementById('badgeModal').style.display='flex';
        playSound('click');
    }
}
document.getElementById('badgeModal').onclick = function(e) { if(e.target === this) this.style.display='none'; }

function openTelegram(){const u=JSON.parse(localStorage.getItem('currentUser'));if(u?.telegram)window.open(u.telegram,'_blank')}
function openViewTelegram(){if(currentViewAccount?.telegram)window.open(currentViewAccount.telegram,'_blank')}
function viewAvatar(src){document.getElementById('avatarViewerImg').src=src;document.getElementById('avatarViewer').style.display='flex'}
function closeAvatarViewer(){document.getElementById('avatarViewer').style.display='none'}
function openSupportLink(){window.open('https://t.me/ouForgeSupport', '_blank');}

function renderGames(){
    const g=document.getElementById('gamesGrid');g.innerHTML='';const sorted=[...games].reverse();
    sorted.forEach(game=>{
        const c=document.createElement('div');c.className='game-card';c.onclick=()=>{playSound('click'); navigateTo('game', game.id)};
        const titleStyle=localStorage.getItem('titleStyle')||'outlined';const customColor=localStorage.getItem('customTitleColor')||'#ffffff';
        let titleClass='game-card-title ';let titleStyleAttr='';
        if(titleStyle==='gradient')titleClass+='gradient';else if(titleStyle==='outlined')titleClass+='outlined';else if(titleStyle==='custom'){titleStyleAttr=`style="color:${customColor}"`}
        c.innerHTML=`${game.update?`<div class="new-badge">NEW<div class="tooltip">${game.updateDate} - v${game.updateVersion}</div></div>`:''}
        <img src="${game.avatar}"><div class="game-card-content"><div class="${titleClass}" ${titleStyleAttr}>${game.title}</div><div style="font-size:calc(var(--font-size-base) - 1px);color:var(--text-secondary)">${game.shortDesc}</div></div>`;g.appendChild(c)
    })
}

function showGame(id, pushHistory = true){
    const g=games.find(x=>x.id===id);if(!g)return;
    currentGame=id;
    if(pushHistory) history.pushState({page: 'game', gameId: id}, '', `#game-${id}`);
    
    document.querySelectorAll('.game-page').forEach(p=>p.style.display='none');
    document.getElementById('mainPage').style.display='none';
    document.getElementById('gamePage').style.display='block';
    
    document.getElementById('gameBanner').src=g.banner;
    document.getElementById('gameAvatar').src=g.avatar;
    const titleStyle=localStorage.getItem('titleStyle')||'outlined';const customColor=localStorage.getItem('customTitleColor')||'#ffffff';
    let titleClass='game-title ';let titleStyleAttr='';
    if(titleStyle==='gradient')titleClass+='gradient';else if(titleStyle==='outlined')titleClass+='outlined';else if(titleStyle==='custom'){titleStyleAttr=`style="color:${customColor}"`}
    document.getElementById('gameTitle').className=titleClass;
    if(titleStyleAttr)document.getElementById('gameTitle').setAttribute('style',`color:${customColor}`);else document.getElementById('gameTitle').removeAttribute('style');
    document.getElementById('gameTitle').textContent=g.title;
    document.getElementById('gameBadge').innerHTML=g.update?`<div class="new-badge">NEW<div class="tooltip">${g.updateDate} - v${g.updateVersion}</div></div>`:'';
    const devMode=localStorage.getItem('devMode')==='true';
    document.getElementById('gameIdDisplay').textContent=`game id: ${g.id}`;
    document.getElementById('gameIdDisplay').style.display=devMode?'block':'none';
    document.getElementById('gameDescription').textContent=g.description;
    
    const pt=JSON.parse(localStorage.getItem('playtime'));
    const lp=JSON.parse(localStorage.getItem('lastPlayed'));
    const playtimeHours=((pt[id]||0)/60).toFixed(1);
    const t=translations[currentLang];
    document.getElementById('playtimeDisplay').innerHTML=`<span>${playtimeHours} ${t.hoursPlayed}</span>`;
    document.getElementById('lastPlayedDisplay').textContent = lp[id] ? t.lastPlayed.replace('{date}', lp[id]) : '';
    
    const gal=document.getElementById('gameGallery');gal.innerHTML='';
    g.gallery.forEach(i=>{const img=document.createElement('img');img.src=i;img.onclick=()=>viewAvatar(i); gal.appendChild(img)});
    
    document.getElementById('minReq').innerHTML=g.minReq;document.getElementById('recReq').innerHTML=g.recReq;
    const reviewsSection=document.getElementById('reviewsSection');reviewsSection.innerHTML='';
    if(g.reviews&&g.reviews.length>0){g.reviews.forEach(review=>{const reviewCard=document.createElement('div');reviewCard.className='review-card';const stars='‚≠ê'.repeat(review.rating);reviewCard.innerHTML=`<div class="review-header"><img class="review-avatar" src="${review.avatar}" alt="${review.author}" onclick="viewAvatar('${review.avatar}')"><div><div class="review-author">${review.author}</div><div class="review-date">${review.date}</div></div><div class="review-rating">${stars}</div></div><div class="review-text">${review.text}</div>`;reviewsSection.appendChild(reviewCard)})}else reviewsSection.innerHTML=`<p style="text-align:center;color:var(--text-secondary)">No reviews yet</p>`;
    
    const lib=JSON.parse(localStorage.getItem('library'));
    const paths=JSON.parse(localStorage.getItem('exePaths'));
    const inLib=lib.includes(id);const hasPath=paths[id]&&paths[id].trim()!=='';
    
    document.getElementById('addToLibraryBtn').textContent=inLib?t.removeFromLibrary:t.addToLibrary;
    if(inLib&&hasPath){
        document.getElementById('downloadBtn').style.display='inline-block';
        document.getElementById('downloadBtn').textContent=t.launch;
        document.getElementById('downloadBtn').onclick=()=>openLaunchModal(true)
    }else if(inLib){
        document.getElementById('downloadBtn').style.display='inline-block';
        document.getElementById('downloadBtn').textContent=t.download;
        document.getElementById('downloadBtn').onclick=downloadGame
    }else{document.getElementById('downloadBtn').style.display='none'}
    
    document.getElementById('exeSettingsBtn').style.display=inLib?'inline-block':'none';
}

function addToLibrary(){const lib=JSON.parse(localStorage.getItem('library'));const i=lib.indexOf(currentGame);i>-1?lib.splice(i,1):lib.push(currentGame);localStorage.setItem('library',JSON.stringify(lib));showGame(currentGame, false)}

function updateRecentGames(id) {
    let recent = JSON.parse(localStorage.getItem('recentGames')) || [];
    const dateStr = new Date().toLocaleString();
    recent = recent.filter(r => r.id !== id);
    recent.unshift({id: id, date: dateStr});
    localStorage.setItem('recentGames', JSON.stringify(recent));
}

function updateLastPlayed() {
    const lp = JSON.parse(localStorage.getItem('lastPlayed'));
    const now = new Date();
    const timeStr = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
    lp[currentGame] = timeStr;
    localStorage.setItem('lastPlayed', JSON.stringify(lp));
    document.getElementById('lastPlayedDisplay').textContent = translations[currentLang].lastPlayed.replace('{date}', timeStr);
    
    updateRecentGames(currentGame);
}

function downloadGame(){
    updateLastPlayed();
    window.open(games.find(g=>g.id===currentGame).downloadUrl,'_blank');
}

function addPlaytime(){document.getElementById('playtimeModal').style.display='flex'}
function closePlaytimeModal(){document.getElementById('playtimeModal').style.display='none'}

function savePlaytime(){
    const m=parseInt(document.getElementById('playtimeInput').value)||0;
    if(m>0){
        const pt=JSON.parse(localStorage.getItem('playtime'));
        pt[currentGame]=(pt[currentGame]||0)+m;
        localStorage.setItem('playtime',JSON.stringify(pt));
        
        const daily = JSON.parse(localStorage.getItem('dailyPlaytime'));
        const key = new Date().toISOString().split('T')[0];
        daily[key] = (daily[key] || 0) + m;
        localStorage.setItem('dailyPlaytime', JSON.stringify(daily));

        closePlaytimeModal();
        showGame(currentGame, false);
        checkAuth(); 
    }
}

function removePlaytime(){
    const pt=JSON.parse(localStorage.getItem('playtime'));
    const currentTime=pt[currentGame]||0;
    if(currentTime>0){
        const removeAmount=prompt(translations[currentLang].minutes+':','30');
        if(removeAmount!==null){
            const minutes=parseInt(removeAmount)||0;
            if(minutes>0){
                pt[currentGame]=Math.max(0,currentTime-minutes);
                localStorage.setItem('playtime',JSON.stringify(pt));
                showGame(currentGame, false);
                checkAuth();
            }
        }
    }
}

function openExeSettings(){const p=JSON.parse(localStorage.getItem('exePaths'))[currentGame]||'';document.getElementById('exePath').value=p;document.getElementById('exeModal').style.display='flex'}
function closeExeModal(){document.getElementById('exeModal').style.display='none'}
function saveExePath(){const p=document.getElementById('exePath').value;const paths=JSON.parse(localStorage.getItem('exePaths'));p?paths[currentGame]=p:delete paths[currentGame];localStorage.setItem('exePaths',JSON.stringify(paths));closeExeModal();alert(translations[currentLang].saved);showGame(currentGame, false)}

function openLaunchModal(isLaunch = false){
    const paths=JSON.parse(localStorage.getItem('exePaths'));let path=paths[currentGame]||'';if(path&&!path.startsWith('"')&&!path.endsWith('"')){path=`"${path}"`}const t=translations[currentLang];document.getElementById('launchModalTitle').textContent=t.launchInstructions;document.getElementById('launchStep1').textContent=t.launchStep1;document.getElementById('launchStep2').textContent=t.launchStep2;document.getElementById('launchStep3').textContent=t.launchStep3;document.getElementById('copyCommandBtn').textContent=t.copyCommand;document.getElementById('launchCommand').textContent=`start "" ${path}`;document.getElementById('launchModal').style.display='flex';
    if(isLaunch) updateLastPlayed();
}
function closeLaunchModal(){document.getElementById('launchModal').style.display='none'}
function copyLaunchCommand(){const command=document.getElementById('launchCommand').textContent;navigator.clipboard.writeText(command).then(()=>{const btn=document.getElementById('copyCommandBtn');const originalText=btn.textContent;btn.textContent=translations[currentLang].commandCopied;setTimeout(()=>{btn.textContent=originalText},2000)})}

function openNotes() {
    const notes = JSON.parse(localStorage.getItem('gameNotes'));
    document.getElementById('gameNotesInput').value = notes[currentGame] || '';
    document.getElementById('notesModal').style.display = 'flex';
}
function closeNotesModal() { document.getElementById('notesModal').style.display = 'none'; }
function saveNotes() {
    const notes = JSON.parse(localStorage.getItem('gameNotes'));
    notes[currentGame] = document.getElementById('gameNotesInput').value;
    localStorage.setItem('gameNotes', JSON.stringify(notes));
    closeNotesModal();
}

function toggleRequirements(t){document.querySelectorAll('.req-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.requirements').forEach(r=>r.classList.remove('active'));if(t==='min'){document.querySelector('.req-btn:first-child').classList.add('active');document.getElementById('minReq').classList.add('active')}else{document.querySelector('.req-btn:last-child').classList.add('active');document.getElementById('recReq').classList.add('active')}}

function showPage(p, pushHistory = true){
    document.querySelectorAll('.game-page').forEach(el=>el.style.display='none');
    document.getElementById('mainPage').style.display='none';
    
    if(pushHistory) history.pushState({page: p}, '', `#${p}`);
    
    if(p==='main')document.getElementById('mainPage').style.display='block';
    else if(p==='library'){document.getElementById('libraryPage').style.display='block';renderLibrary()}
    else if(p==='profile'){document.getElementById('profilePage').style.display='block';checkAuth()}
    else if(p==='settings')document.getElementById('settingsPage').style.display='block';
    else if(p==='faq'){document.getElementById('faqPage').style.display='block';renderFAQ();}
    if(document.getElementById('sidebar').classList.contains('open'))toggleSidebar()
}

function renderLibrary(){const lib=JSON.parse(localStorage.getItem('library'));const g=document.getElementById('libraryGrid');const t=translations[currentLang];g.innerHTML=lib.length===0?`<p style="grid-column:1/-1;text-align:center;color:var(--text-secondary)">${t.empty}</p>`:'';lib.forEach(id=>{const game=games.find(x=>x.id===id);if(!game)return;const c=document.createElement('div');c.className='game-card';c.onclick=()=>{playSound('click'); navigateTo('game', id)};const titleStyle=localStorage.getItem('titleStyle')||'outlined';const customColor=localStorage.getItem('customTitleColor')||'#ffffff';let titleClass='game-card-title ';let titleStyleAttr='';if(titleStyle==='gradient')titleClass+='gradient';else if(titleStyle==='outlined')titleClass+='outlined';else if(titleStyle==='custom'){titleStyleAttr=`style="color:${customColor}"`}c.innerHTML=`${game.update?`<div class="new-badge">NEW<div class="tooltip">${game.updateDate} - v${game.updateVersion}</div></div>`:''}
<img src="${game.avatar}"><div class="game-card-content"><div class="${titleClass}" ${titleStyleAttr}>${game.title}</div><div style="font-size:calc(var(--font-size-base) - 1px);color:var(--text-secondary)">${game.shortDesc}</div></div>`;g.appendChild(c)})}

function search(){
    const q=document.getElementById('searchInput').value.toLowerCase();const r=document.getElementById('searchResults');const t=translations[currentLang];
    if(!q){r.style.display='none';return}
    const gr=games.filter(g=>g.title.toLowerCase().includes(q));
    const ar=accounts.filter(a=>a.nickname.toLowerCase().includes(q));
    const devMode=localStorage.getItem('devMode')==='true';
    
    if(!gr.length&&!ar.length){r.innerHTML=`<div style="padding:15px;text-align:center">${t.nothingFound}</div>`;r.style.display='block';return}
    r.innerHTML='';
    gr.forEach(g=>{const i=document.createElement('div');i.className='search-result-item';i.onclick=()=>{playSound('click'); navigateTo('game', g.id);document.getElementById('searchInput').value='';r.style.display='none'};i.innerHTML=`<img src="${g.avatar}"><div><div style="font-weight:bold">${g.title}</div><div style="font-size:14px;color:var(--text-secondary)">${g.shortDesc}</div></div><div class="search-result-type game">${t.game}</div>`;r.appendChild(i)});
    ar.forEach(a=>{
        const i=document.createElement('div');
        i.className='search-result-item';
        i.onclick=()=>{playSound('click'); openAccountView(a);document.getElementById('searchInput').value='';r.style.display='none'};
        
        // Level/XP for search
        const lvlData = calculateLevel(a.exp);
        const badgeHTML=a.badge?`<img src="${a.badge}" style="width:20px;height:20px;margin-left:5px">`:'';
        const primeClass = a.prime ? 'prime-user' : '';
        const uidStr = devMode ? ` | UID: ${a.uid}` : '';
        
        i.innerHTML=`
            <img src="${a.avatar}">
            <div>
                <div style="font-weight:bold;display:flex;align-items:center" class="${primeClass}">${a.nickname}${badgeHTML}</div>
                <div style="font-size:12px;color:var(--text-secondary)">Lvl ${lvlData.level} (${a.exp} XP)${uidStr}</div>
            </div>
            <div class="search-result-type account">${t.account}</div>
        `;
        r.appendChild(i)
    });
    r.style.display='block'
}
function openAccountView(a){
    currentViewAccount=a;
    const t=translations[currentLang];
    const devMode=localStorage.getItem('devMode')==='true';
    
    document.getElementById('viewProfileAvatar').src=a.avatar;
    document.getElementById('viewProfileName').textContent=a.nickname;
    document.getElementById('viewProfileName').className = a.prime ? 'profile-name prime-user' : 'profile-name';
    
    const viewBadgeHTML=a.badge?`<img src="${a.badge}" style="width:24px;height:24px;margin-left:10px;cursor:pointer" onclick="handleViewBadgeClick()">`:'';
    document.getElementById('viewProfileName').innerHTML=`${a.nickname}${viewBadgeHTML}`;
    document.getElementById('viewProfileCreated').textContent=`${t.created}: ${a.created}`;
    document.getElementById('viewProfileTelegram').style.display=a.telegram?'inline-flex':'none';
    const contactBtn=document.getElementById('viewProfileTelegram');
    contactBtn.innerHTML=`<span>üì±</span><span>${t.contact}</span>`;
    
    // Render Level in View Modal
    const lvlData = calculateLevel(a.exp);
    const lvlClass = getLevelClass(lvlData.level);
    const lvlContainer = document.getElementById('viewLevelContainer');
    let shapeContent = lvlData.level;
    if(lvlData.level >= 50) shapeContent = `<span class="lvl-text-gradient">${lvlData.level}</span>`;
    
    lvlContainer.innerHTML = `
        <div class="level-shape ${lvlClass}">${shapeContent}</div>
        <div class="level-info">
            <span style="font-weight:bold; color:var(--text-primary)">Level ${lvlData.level}</span>
            <span>${a.exp} / ${lvlData.nextReq} XP</span>
        </div>
    `;
    
    // Dev Mode UID
    const uidDisplay = document.getElementById('viewProfileUid');
    if(devMode){
        uidDisplay.style.display='block';
        uidDisplay.textContent = `UID: ${a.uid}`;
    } else {
        uidDisplay.style.display='none';
    }

    document.getElementById('accountViewModal').style.display='flex'
}

function handleViewBadgeClick(){
    if(currentViewAccount && currentViewAccount.badgeText){
        document.getElementById('badgeModalText').textContent = currentViewAccount.badgeText;
        document.getElementById('badgeModal').style.display='flex';
        playSound('click');
    }
}

function closeAccountViewModal(){document.getElementById('accountViewModal').style.display='none';currentViewAccount=null}

function exportBackup(){
    let userToExport = null;
    const rawUser = localStorage.getItem('currentUser');
    if(rawUser) {
        userToExport = JSON.parse(rawUser);
        delete userToExport.exp; 
        delete userToExport.level; 
        delete userToExport.prime; 
        delete userToExport.uid; 
    }

    const b={
        version:'0.1.0',
        date:new Date().toISOString(),
        currentUser: JSON.stringify(userToExport), 
        library:localStorage.getItem('library'),
        exePaths:localStorage.getItem('exePaths'),
        playtime:localStorage.getItem('playtime'),
        theme:localStorage.getItem('theme'),
        style:localStorage.getItem('style'),
        font:localStorage.getItem('font'),
        size:localStorage.getItem('size'),
        language:localStorage.getItem('language'),
        devMode:localStorage.getItem('devMode'),
        titleStyle:localStorage.getItem('titleStyle'),
        customTitleColor:localStorage.getItem('customTitleColor'),
        lastPlayed: localStorage.getItem('lastPlayed'),
        gameNotes: localStorage.getItem('gameNotes'),
        dailyPlaytime: localStorage.getItem('dailyPlaytime'),
        recentGames: localStorage.getItem('recentGames'),
        soundVolume: localStorage.getItem('soundVolume')
    };
    const blob=new Blob([JSON.stringify(b,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=`fragment_backup_${new Date().toISOString().split('T')[0]}.json`;a.click();URL.revokeObjectURL(url);alert(translations[currentLang].exported)
}
function importBackup(e){const f=e.target.files[0];if(f){const r=new FileReader();r.onload=e=>{try{const b=JSON.parse(e.target.result);Object.keys(b).forEach(k=>{if(b[k]&&k!=='version'&&k!=='date')localStorage.setItem(k,b[k])});alert(translations[currentLang].imported);location.reload()}catch{alert(translations[currentLang].invalidFile)}};r.readAsText(f)}}

document.addEventListener('click',e=>{if(!document.querySelector('.search-container').contains(e.target)){document.getElementById('searchResults').style.display='none'}});
document.getElementById('notesModal').onclick = (e) => { if(e.target === document.getElementById('notesModal')) closeNotesModal(); };
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open')}
function createSnowflakes(){const snowContainer=document.createElement('div');snowContainer.id='snowContainer';snowContainer.style.position='fixed';snowContainer.style.top='0';snowContainer.style.left='0';snowContainer.style.width='100%';snowContainer.style.height='100%';snowContainer.style.pointerEvents='none';snowContainer.style.zIndex='5';document.body.appendChild(snowContainer);for(let i=0;i<50;i++){createSnowflake()}setInterval(createSnowflake,300)}
function createSnowflake(){const snowContainer=document.getElementById('snowContainer');if(!snowContainer)return;const snowflake=document.createElement('div');snowflake.className='snowflake';snowflake.textContent='‚ùÑ';snowflake.style.left=Math.random()*100+'%';snowflake.style.opacity=Math.random()*0.6+0.3;snowflake.style.fontSize=Math.random()*1.5+0.5+'em';const duration=Math.random()*10+10;snowflake.style.animationDuration=duration+'s';snowflake.style.animationDelay=Math.random()*5+'s';snowContainer.appendChild(snowflake);setTimeout(()=>{snowflake.remove()},(duration+5)*1000)}

function changeTheme(){const t=document.getElementById('themeSelect').value;localStorage.setItem('theme',t);applyTheme(t)}
function applyTheme(t){document.body.classList.remove('light-theme','neon-theme');if(t==='light')document.body.classList.add('light-theme');else if(t==='neon')document.body.classList.add('neon-theme')}
function changeStyle(){const s=document.getElementById('styleSelect').value;localStorage.setItem('style',s);applyStyle(s)}
function applyStyle(s){document.body.classList.remove('cosmic-theme');if(s==='cosmic')document.body.classList.add('cosmic-theme')}
function changeFont(){const f=document.getElementById('fontSelect').value;localStorage.setItem('font',f);applyFont(f)}
function applyFont(f){document.body.classList.remove('font-default','font-monospace','font-rounded');document.body.classList.add(`font-${f}`)}
function changeSize(){const s=document.getElementById('sizeSelect').value;localStorage.setItem('size',s);applySize(s)}
function applySize(s){document.body.classList.remove('size-compact','size-large');if(s!=='normal')document.body.classList.add(`size-${s}`)}

function changeTitleStyle(){const style=document.getElementById('titleStyleSelect').value;localStorage.setItem('titleStyle',style);if(style==='custom'){document.getElementById('customColorGroup').style.display='block';const color=document.getElementById('customColorPicker').value;localStorage.setItem('customTitleColor',color)}else{document.getElementById('customColorGroup').style.display='none'}renderGames();const lib=JSON.parse(localStorage.getItem('library'));const g=document.getElementById('libraryGrid');if(g.children.length>0){lib.forEach(id=>{const game=games.find(x=>x.id===id);if(!game)return;const cards=g.querySelectorAll('.game-card');cards.forEach(card=>{const titleEl=card.querySelector('.game-card-title');if(titleEl){titleEl.className='game-card-title ';titleEl.removeAttribute('style');if(style==='gradient')titleEl.classList.add('gradient');else if(style==='outlined')titleEl.classList.add('outlined');else if(style==='custom'){const customColor=localStorage.getItem('customTitleColor')||'#ffffff';titleEl.style.color=customColor}}})})}}
function handleBackupClick(){devModeClicks++;if(devModeTimeout){clearTimeout(devModeTimeout)}devModeTimeout=setTimeout(()=>{devModeClicks=0},1000);if(devModeClicks===5){const currentDevMode=localStorage.getItem('devMode')==='true';const newDevMode=!currentDevMode;localStorage.setItem('devMode',newDevMode.toString());alert(translations[currentLang][newDevMode?'devModeOn':'devModeOff']);devModeClicks=0}}
function openRandomGame(){if(games.length>0){const randomIndex=Math.floor(Math.random()*games.length);navigateTo('game', games[randomIndex].id)}}
loadData();
</script>
<script type="module" src="/index.tsx"></script>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}
</script>

</body>
</html>
